[
  {
    "objectID": "spatial_inequality.html",
    "href": "spatial_inequality.html",
    "title": "Spatial Inequality",
    "section": "",
    "text": "Geographic income inequality has risen more than 40% between 1980 and 2021.\n– U.S. Department of Commerce (2023)"
  },
  {
    "objectID": "spatial_inequality.html#packages",
    "href": "spatial_inequality.html#packages",
    "title": "Spatial Inequality",
    "section": "3.1 Packages",
    "text": "3.1 Packages\n\n1import inequality as ineq\n2import numpy as np\nimport pandas as pd\nimport geopandas as gpd\nimport libpysal as lps\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport watermark\n%load_ext watermark\n%watermark -a \"Sergio Rey\" -u -n -t -v \\\n    -p numpy,pandas,scipy,matplotlib,inequality,seaborn,libpysal\n\n\n1\n\nWe alias the package inequality as ineq\n\n2\n\nWe do the same for numpy\n\n\n\n\nThe watermark extension is already loaded. To reload it, use:\n  %reload_ext watermark\nAuthor: Sergio Rey\n\nLast updated: Wed Aug 21 2024 10:55:35\n\nPython implementation: CPython\nPython version       : 3.12.4\nIPython version      : 8.26.0\n\nnumpy     : 2.0.1\npandas    : 2.2.2\nscipy     : 1.14.0\nmatplotlib: 3.9.1\ninequality: 0.1.dev170+gd70b5c0.d20240820\nseaborn   : 0.13.2\nlibpysal  : 4.12.0\n\n\n\nOur analysis of spatial inequality utilizes packages from the Python Spatial Analysis Library (pysal) (Rey et al., 2022), together with geopandas (Jordahl et al., 2019) and seaborn (Waskom, 2021). The main package focusing on measuring spatial disparities is inequality, which implements analytics for measuring a-spatial inequality and spatially explicit inequality measures. Also, from pysal, we will depend on the libpysal package for constructing spatial weights that are central to the analysis of spatial inequality. geopandas provides for spatial data processing and producing maps of the spatial distribution of income, while we adopt seaborn for constructing a-spatial graphical views of inequality.\nFor purposes of reproducibility, we include the watermark package which reports the version numbers of each of the packages we use in our analysis."
  },
  {
    "objectID": "spatial_inequality.html#visualizing-inequality-in-distributions",
    "href": "spatial_inequality.html#visualizing-inequality-in-distributions",
    "title": "Spatial Inequality",
    "section": "5.1 Visualizing Inequality in Distributions",
    "text": "5.1 Visualizing Inequality in Distributions\nWe begin with different perspectives on the distribution of state incomes in Mexico. From a geographical perspective, Figure 2 shows the spatial distribution of incomes for the last year of the sample (2000).\n\npth = lps.examples.get_path(\"mexicojoin.shp\")\ngdf = gpd.read_file(pth)\nax = gdf.plot(column=\"PCGDP2000\", k=5, scheme=\"Quantiles\",\n              legend=True,\n              edgecolor='grey',\n              legend_kwds={\"loc\": \"center left\",\n                           \"bbox_to_anchor\": (1, 0.5),\n                           \"fmt\": \"{:.0f}\"})\nax.set_axis_off()\nax.set_title(\"PC GDP 2000\");\n\n\n\n\n\n\n\nFigure 2: Per Capita Gross Domestic Product by State (Quintiles)\n\n\n\n\n\nThis is a choropleth map using quintiles to classify the incomes. The visual impression is that incomes are not randomly distributed in Mexico, as the states with incomes below the bottom quintile are more concentrated in the south, while in the north, the highest income states dominate. We will be able to make more quantitative evaluation of this spatial pattern later on in this chapter.\nFigure 3 presents a different perspective on income distribution based on the concept of Pen’s Parade, introduced by Dutch economist Jan Pen (Pen, 1971). The metaphor uses a Parade to illustrate economic inequality, with each person representing a state in the economy, and their height being proportional to the state’s per capita income. The Parade starts with the shortest individuals depicting the poorest states, gradually increasing in height as income rises. At the end of the parade, the tallest individuals represent the most affluent states, highlighting the significant income disparities across states. This visual tool showcases the inequality in income distribution. The parade uses two different scales, with the x-axis showing the ordinal distances between states and the y-axis representing the interval distances in their per capita incomes.\n\nfrom inequality.pen import pen\nf = pen(gdf, 'PCGDP2000', 'NAME')\n\n\n\n\n\n\n\nFigure 3: Pen’s Parade Per Capita Gross Domestic Product by State 2000\n\n\n\n\n\nWe can start to integrate the spatial and attribute distributions together using a pengram from the pysal-inequality package:\n\nfrom inequality.pen import pengram\nf = pengram(gdf, 'PCGDP2000', 'NAME', xticks=False, leg_pos='lower left',\n        fmt=\"{:.0f}\")\n\n\n\n\n\n\n\nFigure 4: Pengram Per Capita Gross Domestic Product by State 2000\n\n\n\n\n\nAs shown in Figure 4, the pengram combines the Pen’s Parade alongside the choropleth map. This affords a more granular view of the distribution than those offered by either view in isolation. For example, one of the well-known limitations of a quintile classed map is that the intra-class variation is obscured. In the pengram, the intra-class variation now becomes visible through the Pen’s Parade, revealing the much larger absolute and relative variance above the upper quintile relative to the other classes.\nA second feature of the pengram is the ability to query for specific observations. This makes it possible to locate the position of a state in both the Pen’s Parade (attribute space) as well as on the map (geographical space). We do this for states occupying the two extremes of the attribute distribution: Chiapas and Distrito Federal in Figure 5. While the two reside in the extremes of the attribute distribution, the high income Distrito Federal is in the center of the geographic distribution while Chiapas is on the southern border of the country. Moreover, although Distrito Federal stands out in the Pen’s Parade, its small geographic area makes it difficult to identify on the map without the query functionality of the pengram.\n\nfrom inequality.pen import pengram\nf = pengram(gdf, 'PCGDP2000', 'NAME',  leg_pos='lower left',\n            fmt=\"{:.0f}\",\n            xticks=False,\n            query=['Chiapas', 'Distrito Federal'])\n\n\n\n\n\n\n\nFigure 5: Querying the Pengram of Per Capita Gross Domestic Product by State 2000\n\n\n\n\n\n\nReturning to a more granular view of the attribute distribution, Figure 6 combines a histogram of the distribution together with a kernel density estimate, and a rug plot. The latter signifies the positions of each state as short ticks on the x-axis. The outlier nature of the Distrito Federal that we saw in the pengram is responsible for the positive (right) skew of the density function. There is some evidence of polarization in the distribution with the mode being at the poorest group of states and other, lower, peaks in the middle of the distribution.\n\nyears = range(1940, 2010, 10)\nyvars = [f'pcgdp{year}' for year in years]\nsns.histplot(df[yvars[-1]], kde=True, element=\"step\",\n             bins=10, edgecolor=\"black\")\nsns.rugplot(df[yvars[-1]], color='blue')\nplt.show()\n\n\n\n\n\n\n\nFigure 6: Distribution Per Capita Gross Domestic Product by State 2000, histogram, kernel density, rug plot\n\n\n\n\n\nInequality in a distribution is often considered by an inspection of the shares of overall income belonging to units at different locations within the distribution. Here, we must keep in mind, the distinction between the different units under study in the analysis of spatial versus personal income inequality. In spatial inequality analysis, we essentially treat each state as an “individual” and set that individual’s level of income to the state’s per capita income. The share for the state is then derived as the ratio of its per capita income to the sum of the per capita income of all states.\nThese shares can be portrayed in a Lorenz curve, shown in Figure 7, which orders the states by their per capita incomes from lowest to highest. Then, against the cumulative proportion of states (x-axis) we plot the cumulative income share on the y-axis. Both scales have limits of \\([0, 1]\\). In the case of perfect equality, where all state per capita incomes are equal, this plot would be a 45-degree line, the so called line of perfect equality. Any departure from perfect equality will result in states with above average per capita income receiving more than \\(1/n\\) share of \\(n \\bar{y}\\), while states with below average per capita incomes will have shares below \\(1/n\\).3\n\nfrom inequality.schutz import Schutz\ns = Schutz(gdf, 'PCGDP2000')\ns.plot(xlabel='Share of States', ylabel='Share of Per Capita Income')\n\n\n\n\n\n\n\nFigure 7: Lorenz Curve and Schutz Line Per Capita Gross Domestic Product by State 2000"
  },
  {
    "objectID": "spatial_inequality.html#measures-of-inequality",
    "href": "spatial_inequality.html#measures-of-inequality",
    "title": "Spatial Inequality",
    "section": "5.2 Measures of Inequality",
    "text": "5.2 Measures of Inequality\nWe can derive two indices from the Lorenz curve: the Gini coefficient and the Schutz coefficient. The Gini coefficient is an area measurement expressed as a ratio of the area of the lens above the Lorenz curve but below the diagonal to area under the line of perfect equality. The Schutz coefficient is a distance measure defined as the maximum vertical distance between the equality diagonal and the Lorenz curve. Both coefficients measure the extent to which the Lorenz curve departs from perfect equality. Moreover, both indices run from 0, perfect equality, to 1, maximal inequality.\nFor 2000, the Gini coefficient is 0.258, while the Schutz coefficient is 0.195. As they are both scaled to be within the unit interval, the temptation is to compare the two values. However, this would be misleading as we recall one is a measure of area, the second a measure of distance. Instead, each coefficient is often used to compare across distributions, either over time or space. We can do this for Mexico by asking what has happened to inequality over time. Along the way, we add a third commonly used indicator of inequality, the coefficient of variation (\\(CV\\)). The coefficient of variation is a relative measure of variation as it is defined as the ratio of the standard deviation to the sample mean.\n\nyvars = [f'PCGDP{year}' for year in years]\nginis = [ineq.gini.Gini(gdf[yvar]).g for yvar in yvars]\nres_df = pd.DataFrame(data=ginis, columns=['Gini'], index=years)\ncv = gdf[yvars].std() / gdf[yvars].mean() \nres_df['CV'] = cv.values\ns = [ineq.schutz.Schutz(gdf, yvar).distance for yvar in yvars]\nres_df['Schutz'] = s\nres_df['Gini_rank'] = res_df['Gini'].rank()\nres_df['CV_rank'] = res_df['CV'].rank()\nres_df['Schutz_rank'] = res_df['Schutz'].rank()\nres_df\n\n\n\nTable 1: Inequality Index Rankings\n\n\n\n\n\n\n\n\n\n\nGini\nCV\nSchutz\nGini_rank\nCV_rank\nSchutz_rank\n\n\n\n\n1940\n0.353724\n0.719858\n0.260037\n7.0\n7.0\n7.0\n\n\n1950\n0.296446\n0.624611\n0.213920\n6.0\n6.0\n6.0\n\n\n1960\n0.253718\n0.492447\n0.181549\n3.0\n3.0\n3.0\n\n\n1970\n0.255134\n0.472039\n0.185266\n4.0\n2.0\n4.0\n\n\n1980\n0.245053\n0.462657\n0.179702\n1.0\n1.0\n1.0\n\n\n1990\n0.251818\n0.497729\n0.181363\n2.0\n5.0\n2.0\n\n\n2000\n0.258113\n0.492565\n0.195043\n5.0\n4.0\n5.0\n\n\n\n\n\n\n\n\n\n\nTable 1 shows that the three indices agree that inequality was lowest in 1980, and the highest in 1940. However, while the Gini and Schutz coefficients agree in their rankings, the inclusion of the CV creates discordance. Part of the discordance reflects the sensitivity of the measures to different parts of the income distribution. The Gini coefficient puts more weight on the middle of the distribution, while the CV is more affected by the right tail of the distribution. The discordance also reflects the property that when the Lorenz curves do not intersect, the CV and Gini would agree on the rankings of inequality. However, Figure 8 shows that there are cases where the Lorenz curves intersect.\nThe discordance in rankings complicates whether income inequality between states in Mexico has increased or decreased. The answer now depends upon which temporal interval one chooses. Both the Gini and CV agree that inequality has declined since 1940, irrespective of the terminal year selected. However, they disagree on the answer when the question is whether inequality decreased from, say, 1960 to 1970 or between 1990 and 2000 (see Table 1).\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.stats import cumfreq\n\ndef lorenz_curve(incomes):\n    sorted_incomes = np.sort(incomes)\n    cumulative_incomes = np.cumsum(sorted_incomes)\n    normalized = cumulative_incomes / cumulative_incomes[-1]\n    lorenz_curve = np.insert(normalized, 0, 0)\n    n = len(incomes)\n    x = np.linspace(0.0, 1.0, n + 1)\n    return x, lorenz_curve\n\n\nplt.figure(figsize=(10, 8))\n\nfor yvar in yvars:\n    incomes = gdf[yvar].values\n    x, y = lorenz_curve(incomes)\n    plt.plot(x, y, label=yvar)\n\n# Plotting the line of equality\nplt.plot([0, 1], [0, 1], color='black', linestyle='--')\n\n# Adding titles and labels\nplt.title('Lorenz Curves for PCGDP by Year')\nplt.xlabel('Cumulative Share of States')\nplt.ylabel('Cumulative Share of PCGDP')\nplt.legend()\nplt.grid(True)\nplt.show()\n\n\n\n\n\n\n\nFigure 8: Lorenz Curves by Decade\n\n\n\n\n\nThe CV and Gini are but two of a collection of scalar measures of inequality we could apply. Other commonly employed inequality measures include the variance, the relative mean deviation, logarithmic variance, variance of the logarithms, Atkinson, and Theil.4 Choosing among the rich diversity of inequality measures has been the subject of a vast literature. To help guide that selection, there are five desirable properties of an inequality measure:\n\nSymmetry or anonymity\nPrinciple of transfers\nScale invariance\nReplication invariance\nZero normalization\n\nSymmetry implies that the names of the income receiving unit should be immaterial. That is, if we swap the income of one geographical unit with that of another, the overall inequality measure should not change. The principle of transfers implies that the measure should reflect a reduction in inequality if income is transferred from a richer unit to a poorer unit, as long as the transfer does not reverse their income ranking. Scale invariance means that if all incomes are multiplied by the same constant, inequality remains unchanged. Replication invariance implies that an inequality measure should be unaffected if the population is replicated, meaning that duplicating the entire income distribution does not alter the measure of inequality. Zero normalization means that an inequality measure assigns a value of zero to a perfectly equal income distribution, serving as a baseline where all units have the same income.\nNot all of the inequality measures satisfy all of these five properties. For example, the variance is not scale invariant, and both the logarithmic variance and variance of logarithms fail the principle of transfers property. Even for measures that respect these five properties, their use in comparing the levels of inequality between countries at one point in time, or the same country at different points of time, requires the researcher to specify a social welfare function (Atkinson, 1970).\nHowever, in the study of spatial inequality, it is important to note that all the measures mentioned above share a sixth property: spatial invariance. This means they are insensitive to the geographical distribution of the income values. The spatial invariance is demonstrated in Figure 9, where we compare two spatial distributions, one that is the actual distribution for 2000 and one where we artificially permute the incomes randomly. Despite markedly different spatial patterns, the income distributions summarized in the histograms in the bottom row are identical. Since all of the inequality measures mentioned only consider information about the statistical distribution, each measure will take on the same value whether applied to the spatial distribution on the left or right of the figure.\nFrom a geographical perspective, spatial invariance is not a desirable property in an inequality measure. Let’s now turn our attention to spatially explicit measures of inequality.\n\nfig, axs = plt.subplots(2, 2)\n\ngdf.plot(column='PCGDP2000', ax=axs[0, 0], scheme='quantiles',\n         cmap='viridis')\naxs[0, 0].set_title('PCGDP2000')\naxs[0, 0].axis('off')\n\n\ngdf['PCGDP2000r'] = np.random.permutation(gdf.PCGDP2000)\n\ngdf.plot(column='PCGDP2000r', ax=axs[0, 1], scheme='quantiles',\n         cmap='viridis')\naxs[0, 1].set_title('PCGDP2000 Random')\naxs[0, 1].axis('off')\n\naxs[1, 0].hist(gdf['PCGDP2000'], bins=30, color='skyblue',\n               edgecolor='black')\naxs[1, 0].set_title('PCGDP2000 Histogram')\naxs[1, 0].set_xlabel('PCGDP2000')\naxs[1, 0].set_ylabel('Frequency')\n\naxs[1, 1].hist(gdf['PCGDP2000r'], bins=30, color='skyblue',\n               edgecolor='black')\naxs[1, 1].set_title('PCGDP2000 Random Histogram')\naxs[1, 1].set_xlabel('PCGDP2000r')\naxs[1, 1].set_ylabel('Frequency')\n\nplt.tight_layout()\n\nplt.show()\n\n\n\n\n\n\n\nFigure 9: Spatial Invariance of Distributions"
  },
  {
    "objectID": "spatial_inequality.html#putting-space-into-the-measurement-of-inequality",
    "href": "spatial_inequality.html#putting-space-into-the-measurement-of-inequality",
    "title": "Spatial Inequality",
    "section": "5.3 Putting Space into the Measurement of Inequality",
    "text": "5.3 Putting Space into the Measurement of Inequality\nThe inability of the inequality measures to capture any of the geographical dimensions of inequality stems from the treatment of the geographical units of measurement as individuals, and the desire to respect the principle of symmetry or anonymity that is desired in a classic inequality measure. This enables researchers to draw upon the wealth of knowledge about the properties of classic inequality measures, but at the cost of ignoring geography. In other words, these measures say a lot about inequality in the statistical distribution of incomes but they are silent on the spatial distribution of incomes.\nIn this section, we discuss the approaches used to integrate the spatial and statistical distributions in the study of spatial inequality. Given that these methods take the geographical distribution into account, they can be said to be spatially explicit measures of inequality.\nThese approaches all can be seen as special cases of inequality decomposition.\n\n5.3.1 Regional Inequality Decomposition\nA common approach to introducing geography in the measurement of inequality leverages the fact that certain inequality measures can be decomposed if the individual income receiving units are placed into a set of mutually exclusive and exhaustive groups. The decomposition then identifies the overall inequality that is due to inequality within groups and between the groups.\nTo see how this works, we return to the Theil inequality measure that we mentioned briefly above. Let \\(y_i\\) be the income of unit \\(i\\), and \\(s_i\\) represent the income share of unit \\(i\\) such that \\(s_i = \\frac{y_i}{\\sum_i y_i}\\) and \\(\\sum_i s_i=1\\). Then, consider the distribution of the shares. When all units have the same income \\(s_i = s_j =\n1/n\\). Then the entropy of the shares given as\n\\[ H(y) = \\sum_{i=1}^n s_i \\ln \\frac{1}{s_i}\\] will be maximized at \\(\\ln n\\). In the case of extreme inequality, all but one unit have \\(s_i=0\\) and a single unit has all income \\(s_j=1\\), and \\(H(y)=0\\). Thus, the entropy function can be viewed as an indicator of income equality.\nTo generate an indicator of income inequality, we can contrast an observed distribution’s equality against the maximum:\n\\[T(y) = \\ln n - H(y) = \\ln n - \\sum_{i=1}^n s_i \\ln \\frac{1}{s_i}=\\sum_{i=1}^n s_i \\ln n s_i.\\]\nThis can be viewed as a weighted average of the logarithmic deviations of the shares, with the weights defined as the shares. The logarithmic deviation of share \\(i\\) from perfect equality is \\(\\ln \\frac{s_i}{1/n} = \\ln s_i n\\).\nAlternatively, the Theil index can be defined using relative incomes:\n\\[T = \\frac{1}{n} \\sum_i \\frac{y_i}{\\mu} \\ln \\frac{y_i}{\\mu}\\] where \\(y_i\\) is the income of unit \\(i\\) and \\(\\mu = \\frac{1}{n} \\sum_i y_i\\).\nDecomposition of the overall \\(T\\) measure requires assigning each unit to exactly one of \\(G\\) sets \\(S_1, S_2, \\ldots, S_G\\), with the size of each set given as \\(n_g\\) so that: \\[\n\\sum_{g=1}^G n_g = n.\n\\]\nGiven this, we have:\n\\[Y_g = \\sum_{i \\in S_g} y_i \\ g=1,\\ldots,G\\]\nDefining \\(\\omega_g = \\frac{n_g}{n} \\frac{\\bar{Y}_g}{\\mu}\\), the Theil index can be rewritten as:\n\\[\nT = \\sum_{g=1}^G \\omega_g T_g + \\sum_{g=1}^G \\omega_g \\ln\n\\frac{\\bar{Y}_g}{\\mu}.\n\\tag{1}\\]\nThe first term is the within group inequality defined as a weighted average of the inequality within each group with the weights equal to the group’s share of overall income, with:\n\\[T_g = \\frac{1}{n_g} \\sum_{i \\in S_g} \\frac{y_i}{\\bar{Y}_g} \\ln \\frac{y_i}{\\bar{Y}_g}.\\]\nThe second term in Equation 1 is the between group inequality component, measuring the inequality that would exist if within each group there was no inequality (i.e., all members of the same set have the same income).\nDecomposition of inequality had been widely applied in economics to study inequality between occupational groups, sexes, and races, where individuals would be placed into the mutually exclusive groups and overall individual inequality decomposed into that due to the differences between and within the groups. It was a short jump to adopt this to spatial inequality by using regions to define the groups, with individual units (in our case, states) being assigned to one and only one region.5\nWe will illustrate this for the case of Mexican states using a regional partition due to Hanson (1996) as shown in Figure 10. This regionalization scheme consists of 5 regions, with the size of the regions ranging from 2 states to 10 states.\n\n\n\n\n\n\n\n\nFigure 10: Regional Inequality Decomposition\n\n\n\n\n\nWe can apply the theil module from pysal-inequality to calculate the value of the overall level of inequality as measured by the global Theil index, and its decomposition into the between region inequality and within region inequality components:\n\nfig, axs = plt.subplots(2, 2)\nfrom inequality.theil import TheilDSim\nnp.random.seed(12345)\n\ngdf.plot('PCGDP2000', ax=axs[0, 0], scheme='quantiles',\n         cmap='viridis')\naxs[0, 0].set_title('PCGDP2000')\naxs[0, 0].axis('off')\n\n# Extract the per capita GDP and regimes\nincome = gdf['PCGDP2000']\nregimes = gdf['HANSON98']\n\nres = TheilDSim(income, regimes, 999)\n\ngdf['PCGDP2000r'] = np.random.permutation(gdf.PCGDP2000)\ngdf.plot(column='PCGDP2000r', ax=axs[0, 1], scheme='quantiles',\n         cmap='viridis')\naxs[0, 1].set_title('PCGDP2000 Random')\naxs[0, 1].axis('off')\n\n\n\ngdf['PCGDP2000r'] = np.random.permutation(gdf.PCGDP2000)\ngdf.plot(column='PCGDP2000r', ax=axs[1, 0], scheme='quantiles',\n         cmap='viridis')\naxs[1, 0].set_title('PCGDP2000 Random')\naxs[1, 0].axis('off')\n\nmsg=f'Spatial polarization: {res.bg[0][0]/res.T:.3f}'\nmsg=f'{msg}, pseudo p-value: {res.bg_pvalue[0]}'\nprint(msg)\nrealizations = np.array([t.bg/t.T for t in res.results])\nprint(f'Ho mean: {realizations.mean():.3f}')\n\nkde = sns.kdeplot(realizations, fill=False, color='blue', ax=axs[1,1])\nx, y = kde.get_lines()[0].get_data()\nplt.legend([], [], frameon=False)\n# Fill the area to the right of the specified value\nplt.fill_between(x, y, where=(x &gt;= realizations[0]),\n                 interpolate=True, color='red', alpha=0.5)\n\n# Add vertical line at the specified value\nplt.axvline(x=realizations[0], color='red', linestyle='--')\nplt.xlabel(\"Spatial Polarization\")\nprint(f'Theil: {res.T}')\nprint(f'KB p-value: {(realizations &gt;= realizations[0]).sum()/1000}')\n\nSpatial polarization: 0.341, pseudo p-value: 0.036\nHo mean: 0.139\nTheil: 0.10660832349588023\nKB p-value: 0.036\n\n\n\n\n\n\n\n\nFigure 11: Spatial Polarization\n\n\n\n\n\nThe overall level of regional inequality is 0.106. The between region component stands at 0.036, while the within region element is 0.070. In relative terms, inequality between the regions in Mexico accounts for 34 percent of state income inequality, while inequality between states from the same region is the larger share presenting 72 percent of spatial inequality.\nThe ratio of between to within region inequality has been suggested as a measure of spatial polarization (Zhang and Kanbur, 2001). Since the two components sum to overall inequality, we can re-express the measure of spatial polarization as the ratio of between region to overall inequality. Thus, the level of spatial polarization of state incomes stood at 34 percent in 2000 in Mexico.\nA relevant question here is whether this level of spatial polarization in 2000 should be considered high or not? Another way to express this, is to ask if the polarization is higher than we would expect if state incomes were randomly distributed in space in Mexico in 2000.\nWe can answer this question by developing counter-factual spatial distributions that reflect a null hypothesis of spatially random income distributions. Given the \\(n\\) observations, in our case states, there are \\(n!\\) permutations of incomes that are equally likely. In Figure 11, the maps in the top-right and lower-left are two such realizations, where the observed incomes from 2000 (top-left) have been randomly reassigned to states.\nSince it is not feasible to generate all \\(32!\\) maps in our case,6 we take a sample of 999 such maps from the distribution of permutations. For each of these maps we calculate the spatial polarization measure, and collect all measures to develop a reference distribution for our index under the null of spatially random income distributions. We evaluate our observed spatial polarization index against this distribution and derive a pseudo p-value as the number of counterfactual distributions that generate polarization levels as large as the observed value over the number of permutations plus one.\nThe reference distribution for the polarization index is reported in the bottom right of Figure 11. The area to the right of our observed polarization index of 0.34 is 0.036 of the distribution. By convention, this p-value points to a significant departure from the null, and we would conclude that the level of spatial polarization of incomes in Mexico is significantly different from that expected were incomes generated by a spatially random process.\nThe regional decomposition is a spatially explicit measure of spatial inequality as it is indeed sensitive to the geographical distribution of the income values. It is important to note, however, that it is the spatial polarization index, and not the overall \\(T\\) that is spatially explicit. Each of the counterfactual spatial distributions used to construct the reference distribution for the spatial polarization index would still have the same attribute distribution, with similar means and variances, and levels of overall inequality.\nWhile the regional inequality decomposition is spatially explicit, it treats geography in an aggregated fashion. There are, in essence, two scales of spatial inequality implied in this decomposition. As displayed in Figure 10, the within-regions component might be considered the “local” measure as it compares incomes belonging to the same region to the mean income of the group. The between-regions inequality component, by contrast, views spatial inequality in a more aggregate fashion considering only the differences in regional means.\nA close inspection of the decomposition Equation 1 reveals both the within and between inequality components are functions of a \\(T\\) index. In the former case this is applied to states from the same region, and in the latter case, the \\(T\\) is applied to the means of regional incomes. For the within region component, the actual spatial distribution of the member states within each of their regions is ignored. By the same token, the geographical location of the regions is immaterial to the calculation of the between region component. In other words, once the states have been assigned to regions, geography no longer matters. Thus, we draw a distinction between regional inequality decomposition and spatial inequality decomposition.\n\n\n5.3.2 Spatial Inequality Decomposition\n\nTo capture these ignored dimensions of the spatial distribution, Rey and Smith (2013) suggested a spatial decomposition of the Gini coefficient. Starting from the Gini coefficient expressed as half the relative mean absolute deviation:7 \\[\nGini = \\sum_{i=1}^n \\sum_{j=1}^n \\frac{|y_i - y_j|}{2n^2 \\bar{y}}\n\\tag{2}\\] the sum of the absolute deviations can be decomposed as: \\[\n\\sum_{i=1}^n \\sum_{j=1}^n |y_i - y_j| = \\sum_{i=1}^n \\sum_{j=1}^n w_{i,j} |y_i -\ny_j| + (1-w_{i,j})\\sum_{i=1}^n \\sum_{j=1}^n |y_i - y_j|\n\\tag{3}\\] where \\(w_{i,j} = 1\\) if states \\(i\\) and \\(j\\) are geographical neighbors, \\(w_{i,j}=0\\) otherwise. Here we define neighbors as states that share a border.\nSubstituting Equation 3 into Equation 2 gives: \\[\nGini = \\sum_{i=1}^n \\sum_{j=1}^n \\frac{w_{i,j} |y_i - y_j|}{2n^2 \\bar{y}} +\n\\sum_{i=1}^n \\sum_{j=1}^n \\frac{ (1-w_{i,j}) |y_i - y_j|}{2n^2 \\bar{y}}\n\\tag{4}\\] The first term represents a measure of inequality between neighboring states, while the second term captures inequality between “distant” pairs of states. For most spatial configurations, the number of neighboring pairs will be dwarfed by the number of pairs of states that are distant. So while, in the case of spatially clustered income values, the expectation would be for the average difference in incomes to be smaller for neighboring rather than distant states, our measure of spatial clustering here has to take into account the different cardinality of the two sets of pairs. As such, the relevant comparison is if the first term (second term) is smaller (larger) than what could be expected if state incomes were randomly distributed in space.\nWe apply the Spatial Gini Decomposition to Mexican State incomes in 2000 using pysal-inequality in Figure 12. The adjacency graph based on the criterion of Queen neighbors is shown in the top-right figure. An edge defines a pair of neighboring states.\n\nfig, axs = plt.subplots(2, 2)\nfrom inequality.gini import Gini_Spatial\nimport libpysal\nnp.random.seed(12345)\n\n\ngdf.plot('PCGDP2000', ax=axs[0, 0], scheme='quantiles', cmap='viridis')\naxs[0, 0].set_title('PCGDP2000')\naxs[0, 0].axis('off')\n\n\nwq = libpysal.weights.Queen.from_dataframe(gdf)\nwq.transform = 'B'\ngs2000 = Gini_Spatial(gdf[\"PCGDP2000\"], wq)\n\nincome = gdf['PCGDP1940']\n\ngdf.plot(ax=axs[0, 1])\naxs[0, 1].set_title('Neighbor Graph')\naxs[0, 1].axis('off')\n\n\nwq.plot(gdf, ax=axs[0,1])\n\naxs[1, 0].set_title('Counterfactual')\naxs[1, 0].axis('off')\ngdf['PCGDP2000r'] = np.random.permutation(gdf.PCGDP2000)\ngdf.plot(column='PCGDP2000r', ax=axs[1,0], scheme='quantiles',\n         cmap='viridis')\n\nadsum = gs2000.dtotal\nrealizations = gs2000.wcgp / adsum\nkde = sns.kdeplot(realizations, fill=False, color='blue', ax=axs[1,1])\nx, y = kde.get_lines()[0].get_data()\nplt.legend([], [], frameon=False)\n# Fill the area to the right of the specified value\nplt.fill_between(x, y, where=(x &gt;= gs2000.wcg/adsum),\n                 interpolate=True, color='red', alpha=0.5)\n\n# Add vertical line at the specified value\nplt.axvline(x=gs2000.wcg/adsum, color='red', linestyle='--')\nplt.xlabel(\"Spatial Gini\")\n\n\nplt.tight_layout()\nplt.show()\nG = gs2000\nmsg = f'Expected Distant SADS/Total SADS: {G.e_wcg/adsum:.2f}'\nmsg = f'{msg}, Observed: {G.wcg/adsum:.2f}\\n p-value: {G.p_sim}'\nprint(msg)\n\n\n\n\n\n\n\nFigure 12: Spatial Inequality Decomposition\n\n\n\n\n\nExpected Distant SADS/Total SADS: 0.86, Observed: 0.90\n p-value: 0.01\n\n\nFor inference on the spatial Gini, the same computationally based approach that we used in the Theil decomposition is employed. One of the counterfactuals representing a random permutation of the incomes is shown in the lower-left figure. The reference distribution for the spatial Gini index is shown on the bottom right. Here the spatial Gini is expressed as the share of the overall absolute pair-wise differences due to inequality between distant (non-neighbor) pairs of states. The pseudo p-value (0.01) for the observed index is calculated as the area to its right under the distribution.\nUnder the null, the distant pairs should account for 86 percent of the absolute differences, however, the observed share is much higher at 90 percent. In fact, the p-value indicates that none of the counterfactual spatial distributions of income generated a spatial Gini as large as the one observed. In other words, the inequality between distant pairs of states is larger than the inequality between neighboring states. This pairwise orientation of the spatial Gini decomposition offers a useful complement over the regional decomposition of the Theil approach, as it introduces a more spatially explicit view of the income distribution that demonstrates how spatial autocorrelation affects overall inequality across the states.8\nIt should be noted that the spatial Gini decomposition does not allow for the exact additivity of within-group and between-group inequality components. This is because the Gini index is affected by the degree of overlap in incomes of states belonging to different regions. Any overlap complicates the decomposition because part of the total inequality arises from the overlap itself, which cannot be easily attributed to either within-group or between-group inequality. So instead of a two-way additive decomposition, a residual term is required due to the overlap. Because this residual term is difficult to interpret, the Gini is seldom used for regional inequality decomposition.\n\n\n5.3.3 Weighted or Unweighted Inequality: Places versus People\nA final issue we explore is the question of whether the measure of spatial inequality should take into account the population sizes of the enumeration units. This was briefly mentioned earlier in the context of measuring international inequality. In the regional literature, a debate rages as to whether population weighted or unweighted approaches should be used to measure spatial inequality (Gluschenko, 2018) .\nTo frame the debate, it is helpful to consider three different concepts of inequality at the international scale suggested by Milanović (2007). Here we adapt them to the question of measuring spatial inequality at the sub-national scale. Concept 1 is unweighted spatial inequality, where each state is one unit of measurement, and we use its per capita income irrespective of the state’s population. In addition to being the dominant approach in regional inequality analysis, this concept is at the core of the literature on regional convergence (Rey and Montouri, 1999) where the focus is on whether the incomes of poor and rich states in a system are coming together or growing apart over time.\nConcept 2 takes into account the population of the individual states, recognizing that a state like Nuevo Leon with a population of 8.6 million in 2000 having its average income increase by 10,000 USD is likely to have a larger impact than is seeing the per capita income of Colima, with a population of 500,000 change by the same amount. So here, the per capita incomes of the states are now weighted by the population of the states. This is weighted spatial inequality.\nFinally, Concept 3, measures inequality between all the individuals in the country. Here we would require information on the individuals both in terms of their incomes and their state of residence. Were it available, such data would allow us to measure personal income inequality. However, in the literature on regional inequality, such data is scarce, and so this concept is not operationalized.\nThis means the debate in the regional literature is between proponents of Concept 1 and Concept 2.\nThus far in this paper, we have adopted the Concept 1 definition of spatial inequality, that is, unweighted spatial inequality. We can contrast this with the perspective offered by Concept 2, by developing the Weighted Pengram under concept 2 shown in Figure 13 and comparing it with the Unweighted Pengram from Figure 3. The number of bars for each state in the Weighted Pengram is proportional to the population of that state. The logic behind the weighted spatial inequality is that rather than having one representative observation (individual) from the state with their level of income equal to the state per capita income, now there are a proportional number of individuals from each state having their level of income equal to the state’s per capita income.\n\n\n\n\n\n\n\n\nFigure 13: Populated Weighted Pengram\n\n\n\n\n\nA fundamental issue with this approach is that it assumes that inequality among individuals within the state is zero, since all members have the same level of income. This also implies that for two states that have different levels of per capita income, the poorest members of the richer state will be richer than the richest member of the poorer state. This is at odds with empirical reality."
  },
  {
    "objectID": "spatial_inequality.html#footnotes",
    "href": "spatial_inequality.html#footnotes",
    "title": "Spatial Inequality",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nIt is important to keep in mind that income is measured as a flow whereas wealth is a stock. This distinction matters in terms of the way disparities in the two variables are examined.↩︎\nThe python code used to construct this map is hidden.↩︎\nStates with shares below \\(1/n\\) would also have location quotients of less than one for their relative per capita incomes, where their per capita income was expressed relative to national per capita income.↩︎\nSee Cowell (2011) for an overview of inequality measures.↩︎\nOne of the earliest applications of decomposition for regional inequality analysis is Theil (1967).↩︎\n\\(32! = 2.6313084e+35\\).↩︎\nIt is sometimes stated that the maximum value of the Gini in this form is 1 (e.g., Wang et al., 2024). This is technically incorrect, as in in this form, the Gini has a range of \\([0, (n-1)/n]\\). As \\(n\\) grows larger, the upper bound approaches 1. Moreover, because the upper bound is a function of \\(n\\), care should be taken when using the Gini in this form when comparing distributions of different sizes.↩︎\nFor a recent extension of the spatial Gini decomposition see Panzera and Postiglione (2020).↩︎"
  }
]